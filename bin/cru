#!/bin/sh -euo pipefail
#copyright by monlor
source /tmp/mixbox.conf
source ${MBROOT}/bin/base

# 添加定时任务，利用uci来储存信息，cru {a|d|c} [name] [crontab] 
method="$1"
name="$2"
# content="$3"

case "$method" in
a) 
	[ -z "$name" -o -z "$3" ] && exit 1
	cat ${MBROOT}/config/crontab.txt | grep -E "^${name}," &> /dev/null && logerror "${name}任务已存在！"
	echo "${name},${3}" >> ${MBROOT}/config/crontab.txt
	;;
d) 
	[ -z "$name" ] && exit 1
	pc_delete "^${name}," ${MBROOT}/config/crontab.txt
 	;;
c)
	echo -n > ${MBROOT}/config/crontab.txt
	;;
l)
	cat ${MBROOT}/config/crontab.txt
	;;
esac

general_cron_task

exit 0